<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Math Racing Game</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background: #f4f4f4;
        }
        #track {
            position: relative;
            height: 200px;
            background: #ccc;
            margin: 20px;
            border: 2px solid #333;
            overflow: hidden;
        }
        .car {
            position: absolute;
            width: 50px;
            height: 50px;
            transition: left 0.3s ease;
        }
        #player-car {
            top: 30px;
            background: red;
        }
        #ai-car {
            top: 100px;
            background: blue;
        }
        #finish-line {
            position: absolute;
            top: 0;
            right: 0;
            width: 10px;
            height: 100%;
            background-image: linear-gradient(45deg, black 25%, white 25%, white 50%, black 50%, black 75%, white 75%, white);
            background-size: 10px 10px;
        }
        #question-area {
            background: white;
            padding: 10px;
            text-align: center;
        }
        .answer-btn {
            margin: 5px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body onload="brython()">
    <h1 style="text-align: center;">Math Race</h1>
    <div id="track">
        <div id="player-car" class="car"></div>
        <div id="ai-car" class="car"></div>
        <div id="finish-line"></div>
    </div>
    <div id="question-area">
        <div id="question">Loading question...</div>
        <div id="answers"></div>
    </div>

    <script type="text/python">
from browser import document, html, timer
import random

# Configuration
NUM_QUESTIONS = 10
CAR_STEP_PX = None
AI_INTERVAL_MS = 3000  # milliseconds

# Game State
question_count = 0
player_position = 0
ai_position = 0
correct_answer = None

# DOM Elements
question_div = document["question"]
answers_div = document["answers"]
player_car = document["player-car"]
ai_car = document["ai-car"]
track_div = document["track"]

# Calculate CAR_STEP_PX based on track width and number of questions
track_width_px = track_div.offsetWidth
car_width_px = player_car.offsetWidth
CAR_STEP_PX = (track_width_px - car_width_px - 10) / NUM_QUESTIONS  # minus some margin

def move_car(car_element, steps):
    car_element.style.left = f"{steps * CAR_STEP_PX}px"

def generate_question():
    global correct_answer
    while True:
        op = random.choice(["+", "-"])
        a = random.randint(0, 20)
        b = random.randint(0, 20)
        if op == "-" and b > a:
            a, b = b, a
        result = eval(f"{a} {op} {b}")
        if 0 <= result <= 20:
            correct_answer = result
            question_div.text = f"{a} {op} {b} = ?"
            create_answer_buttons(correct_answer)
            break

def create_answer_buttons(correct):
    answers_div.clear()
    options = set([correct])
    while len(options) < 3:
        fake = random.randint(0, 20)
        options.add(fake)
    shuffled = list(options)
    random.shuffle(shuffled)

    for val in shuffled:
        button = html.BUTTON(str(val), Class="answer-btn")
        button.bind("click", lambda ev, v=val: check_answer(v))
        answers_div <= button

def check_answer(selected):
    global question_count, player_position
    if selected == correct_answer:
        question_count += 1
        player_position += 1
        move_car(player_car, player_position)
        if question_count >= NUM_QUESTIONS:
            end_game("You Win! ðŸŽ‰")
        else:
            generate_question()
    else:
        generate_question()

def ai_move():
    global ai_position
    ai_position += 1
    move_car(ai_car, ai_position)
    if ai_position >= NUM_QUESTIONS:
        end_game("You Lose! ðŸ˜¢")

def end_game(message):
    question_div.text = message
    answers_div.clear()
    timer.clear_interval(ai_timer)

# Start the game
generate_question()
ai_timer = timer.set_interval(ai_move, AI_INTERVAL_MS)
    </script>
</body>
</html>
